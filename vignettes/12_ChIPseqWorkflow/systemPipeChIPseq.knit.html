<!DOCTYPE html>
  <head>

 <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>ChIP-Seq Workflow Template  | GEN242</title>
<link rel="stylesheet" type="text/css" href="../css/syntax.css">
<link rel="stylesheet" type="text/css" href="../css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">-->
<link rel="stylesheet" type="text/css" href="../css/modern-business.css">
<link rel="stylesheet" type="text/css" href="../css/lavish-bootstrap.css">
<link rel="stylesheet" type="text/css" href="../css/customstyles.css">
<link rel="stylesheet" type="text/css" href="../css/theme-blue.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="../js/jquery.navgoco.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="../js/toc.js"></script>
<script src="../js/customscripts.js"></script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<link rel="shortcut icon" href="../common_images/favicon.ico" type="image/x-icon">
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->







 


<script>
  $(function () {
      $('[data-toggle="tooltip"]').tooltip()
  })
</script>



  </head>

<body>

   <!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <a class="fa fa-home fa-lg navbar-brand" href="home.html">&nbsp;<span class="projectTitle"> Data Analysis in Genome Biology</span></a>

        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                









                
                
                
                
                <li><a href="https://piazza.com/class/ilbslqb3j2ovy" target="_blank">Piazza</a></li>
                
                
                
                
                
                <li><a href="https://github.com/tgirke/GEN242" target="_blank">Github Repo</a></li>
                
                
                
                


                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->

                <li class="dropdown">
                    
                    
                    
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Resources<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        
                        <li><a href="https://cran.r-project.org/" target="_blank">CRAN</a></li>
                        
                        
                        
                        
                        
                        <li><a href="http://bioconductor.org/" target="_blank">Bioconductor</a></li>
                        
                        
                        
                        
                        
                        <li><a href="http://manuals.bioinformatics.ucr.edu/home/R_BioCondManual" target="_blank">R & Bioconductor Manual</a></li>
                        
                        
                        
                        
                        
                        <li><a href="https://guides.github.com/activities/hello-world/" target="_blank">GitHub</a></li>
                        
                        
                        
                        
                        
                        <li><a href="http://jekyllrb.com/" target="_blank">Jekyll</a></li>
                        
                        
                        
                        
                        
                        <li><a href="http://girke.bioinformatics.ucr.edu/" target="_blank">Girke Lab</a></li>
                        
                        
                        
                        
                        
                        <li><a href="http://idratherbewriting.com/documentation-theme-jekyll" target="_blank">Jekyll Doc Theme</a></li>
                        
                        
                        
                        

                    </ul>
                </li>
                
                


                <!-- special insertion -->

               
                <!-- Send feedback function -->
<script>
function SendLinkByMail(href) {
var subject= "GEN242 feedback";
var body = "I have some feedback about the ChIP-Seq Workflow Template page: ";
body += window.location.href;
body += "";
var uri = "mailto:?subject=";
uri += encodeURIComponent(subject);
uri += "&body=";
uri += encodeURIComponent(body);
window.location.href = uri;
}
</script>

<li><a href="javascript:(function()%7BSendLinkByMail()%3B%7D)()%3B" target="_blank"><i class="fa fa-envelope-o"></i> Feedback</a></li>


                <!--uncomment this block if you want simple search instead of algolia-->
                <li>
                     <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="../js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                        SimpleJekyllSearch.init({
                            searchInput: document.getElementById('search-input'),
                            resultsContainer: document.getElementById('results-container'),
                            dataSource: '../search.json',
                            searchResultTemplate: '<li><a href="{url}" title="ChIP-Seq Workflow Template">{title}</a></li>',
                        noResultsText: 'No results found.',
                                limit: 10,
                                fuzzy: true,
                        })
                    </script>
                     <!--end search-->
                </li>

            
        </div>
        <!-- /.container -->
</nav>


    <!-- Page Content -->
    <div class="container">
        <div class="col-lg-12">&nbsp;</div>


<!-- Content Row -->
<div class="row">
    <!-- Sidebar Column -->
    <div class="col-md-3">

        <script>

            $(document).ready(function() {
                // Initialize navgoco with default options
                $("#mysidebar").navgoco({
                    caretHtml: '',
                    accordion: true,
                    openClass: 'active', // open
                    save: false, // leave false or nav highlighting doesn't work right
                    cookie: {
                        name: 'navgoco',
                        expires: false,
                        path: '/'
                    },
                    slide: {
                        duration: 400,
                        easing: 'swing'
                    }
                });

                $("#collapseAll").click(function(e) {
                    e.preventDefault();
                    $("#mysidebar").navgoco('toggle', false);
                });

                $("#expandAll").click(function(e) {
                    e.preventDefault();
                    $("#mysidebar").navgoco('toggle', true);
                });

            });

        </script>


        









        <ul id="mysidebar" class="nav">

            <span class="siteTagline">GEN242</span>
            <span class="versionTagline">Spring 2016</span>

            
            
            
                
            
            <li><a href="#">Home</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/home.html">Introduction</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_syllabus.html">Syllabus</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Internal</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/mydoc_internal.html">Internal Resources</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Schedule</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/mydoc_schedule.html">Course Schedule</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Lecture Slides</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_01.html">Course Introduction</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_02.html">Molbiol for Bioinformatics</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_03.html">Databases and Software</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_04.html">DNA Sequencing</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_05.html">Introduction to R</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_06.html">Sequence Alignments</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_07.html">Programming in R</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_08.html">Multiple Alignments</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_09.html">Short Read Alignments</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_10.html">NGS Analysis Basics</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_11.html">Gene Expression Analysis</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_12.html">NGS Workflows</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_13.html">ChIP-Seq Overview</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_14.html">VAR-Seq Overview</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_15.html">Sequence Assembly</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_16.html">Gene Annotation and Ontologies</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_17.html">Cluster Analysis</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_18.html">Profile HMMs</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_slides_19.html">Introduction to Phylogenetics</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Homework</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/mydoc_homework_01.html">HW1 - Online Tools</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_homework_02.html">HW2 - Biocluster/Linux</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_homework_03.html">HW3 - Introduction to R</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_homework_04.html">HW4 - Pairwise Alignments</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Programming_in_R_09.html">HW5 - Programming in R</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rsequences_08.html">HW6 - Sequence Analysis</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">GitHub</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/mydoc_tutorial_01.html">GitHub</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Biocluster & Linux</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/mydoc_tutorial_02.html">Basic Tutorial</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Introduction to R</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rbasics_01.html">1. Overview</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rbasics_02.html">2. R Package Repositories</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rbasics_03.html">3. Installation of R and Add-on Packages</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rbasics_04.html">4. Getting Around</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rbasics_05.html">5. Basic Syntax</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rbasics_06.html">6. Data Types</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rbasics_07.html">7. Data objects</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rbasics_08.html">8. Important Utilities</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rbasics_09.html">9. Operators and Calculations</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rbasics_10.html">10. Reading and Writing External Data</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rbasics_11.html">11. Useful R Functions</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rbasics_12.html">12. SQLite Databases</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rbasics_13.html">13. Graphics in R</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rbasics_14.html">14. Analysis Routine</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rbasics_15.html">15. R Markdown</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rbasics_16.html">16. Session Info</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rbasics_17.html">17. References</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Programming in R</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Programming_in_R_01.html">1. Overview</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Programming_in_R_02.html">2. Control Structures</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Programming_in_R_03.html">3. Loops</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Programming_in_R_04.html">4. Functions</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Programming_in_R_05.html">5. Useful Utilities</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Programming_in_R_06.html">6. Running R Scripts</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Programming_in_R_07.html">7. Building R Packages</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Programming_in_R_08.html">8. Programming Exercises</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Programming_in_R_09.html">9. Homework 5</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Programming_in_R_10.html">10. Session Info</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Programming_in_R_11.html">11. References</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">NGS Analysis Basics</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rsequences_01.html">1. Overview</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rsequences_02.html">2. Package Requirements</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rsequences_03.html">3. Strings in R Base</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rsequences_04.html">4. Sequences in Bioconductor</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rsequences_05.html">5. NGS Sequences</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rsequences_06.html">6. Range Operations</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rsequences_07.html">7. Transcript Ranges</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rsequences_08.html">8. Homework 6</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rsequences_09.html">9. Session Info</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rsequences_10.html">10. References</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">NGS Workflow Overview</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeR_1.html">1. Introduction</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeR_2.html">2. Getting Started</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeR_3.html">3. Workflow overview</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeR_4.html">4. Workflow templates</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeR_5.html">5. Version information</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeR_6.html">6. References</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">RNA-Seq Workflow</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeRNAseq_01.html">1. Introduction</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeRNAseq_02.html">2. Sample definitions and environment settings</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeRNAseq_03.html">3. Read preprocessing</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeRNAseq_04.html">4. Alignments</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeRNAseq_05.html">5. Read quantification per annotation range</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeRNAseq_06.html">6. Analysis of differentially expressed genes with edgeR</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeRNAseq_07.html">7. GO term enrichment analysis of DEGs</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeRNAseq_08.html">8. Clustering and heat maps</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeRNAseq_09.html">9. Version Information</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeRNAseq_10.html">10. Funding</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeRNAseq_11.html">11. References</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">ChIP-Seq Workflow</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeChIPseq_01.html">1. Introduction</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeChIPseq_02.html">2. Load workflow environment</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeChIPseq_03.html">3. Read preprocessing</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeChIPseq_04.html">4. Alignments</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeChIPseq_05.html">5. Utilities for coverage data</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeChIPseq_06.html">6. Peak calling with MACS2</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeChIPseq_07.html">7. Annotate peaks with genomic context</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeChIPseq_08.html">8. Count reads overlapping peaks</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeChIPseq_09.html">9. Differential binding analysis</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeChIPseq_10.html">10. GO term enrichment analysis</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeChIPseq_11.html">11. Motif analysis</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeChIPseq_12.html">12. Version Information</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeChIPseq_13.html">13. Funding</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeChIPseq_14.html">14. References</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">VAR-Seq Workflow</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeVARseq_01.html">1. Introduction</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeVARseq_02.html">2. Load workflow environment</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeVARseq_03.html">3. Read preprocessing</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeVARseq_04.html">4. Alignments</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeVARseq_05.html">5. Variant calling</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeVARseq_06.html">6. Filter variants</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeVARseq_07.html">7. Annotate filtered variants</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeVARseq_08.html">8. Combine annotation results among samples</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeVARseq_09.html">9. Summary statistics of variants</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeVARseq_10.html">10. Venn diagram of variants</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeVARseq_11.html">11. Plot variants programmatically</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeVARseq_12.html">12. Version Information</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeVARseq_13.html">13. Funding</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_systemPipeVARseq_14.html">14. References</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Graphics and Visualization</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rgraphics_1.html">1. Overview</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rgraphics_2.html">2. Base Graphics</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rgraphics_3.html">3. Grid Graphics</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rgraphics_4.html">4. lattice Graphics</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rgraphics_5.html">5. ggplot2 Graphics</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rgraphics_6.html">6. Specialty Graphics</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rgraphics_7.html">7. Genome Graphics</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rgraphics_8.html">8. References</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Cluster Analysis</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rclustering_1.html">1. Introduction</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rclustering_2.html">2. Data Preprocessing</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rclustering_3.html">3. Clustering Algorithms</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rclustering_4.html">4. Clustering Exercises</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rclustering_5.html">5. Version Information</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_Rclustering_6.html">6. References</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Paper Presentations</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/mydoc_paper_presentations.html">Paper Presentations</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Course Projects</a>
                <ul>
                    
                    
                    
                    <li><a href="../mydoc/mydoc_project_00.html">Overview</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_project_01.html">ChIP-Seq1 - Motif Prediction</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_project_02.html">ChIP-Seq2 - Peak Callers</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_project_03.html">RNA-Seq1 - RNA-Seq Aligners</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_project_04.html">RNA-Seq2 - DEG Methods</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_project_05.html">VAR-Seq1 - Variant Callers</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_project_06.html">VAR-Seq2 - Functional Prediction</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="../mydoc/mydoc_project_07.html">Project Data</a></li>
                    

                    

                    
                    
                </ul>
                
                
                


                <!-- if you aren't using the accordion, uncomment this block:

                     <p class="external">
                         <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
                     </p>
                 -->

    </div>
    <!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
    <script>$("li.active").parents('li').toggleClass("active");</script>


            <!-- Content Column -->
            <div class="col-md-9">
                
                <div class="post-header">
   <h1 class="post-title-main">ChIP-Seq Workflow Template</h1>
</div>

<div class="post-content">

   

<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>


<div id="toc"></div>


<!--
    
    <a target="_blank" href="https://github.com/tgirke/manuals/tree/master/mydoc/" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>
    
-->
<!--
%% \VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{ChIP-Seq Workflow Template}
%% \VignetteDepends{rjson, ggplot2, limma, edgeR, DESeq2, GOstats, GO.db, annotate, pheatmap}
%% \VignetteKeywords{compute cluster, pipeline, reports}
%% \VignettePackage{systemPipeR}
-->

<!---
- Conversion from Rnw/tex to Rmd
    - Build vignette from Rnw 
    - Then run: pandoc -s systemPipeChIPseq.tex -o systemPipeChIPseq.text
    - The fix things, usually a lot...

- Compile from command-line
echo "rmarkdown::render('systemPipeChIPseq.Rmd', clean=F)" | R -slave; R CMD Stangle systemPipeChIPseq.Rmd; Rscript ../md2jekyll.R systemPipeChIPseq.knit.md 13

- Commit to github
git commit -am "some edits"; git push -u origin master

- To customize font size and other style features, add this line to output section in preamble:  
    css: style.css
-->

<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script>

<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script>

<p>Note: the most recent version of this tutorial can be found <a href="https://htmlpreview.github.io/?https://github.com/tgirke/GEN242/blob/master/vignettes/12_ChIPseqWorkflow/systemPipeChIPseq.html">here</a> and a short overview slide show <a href="https://docs.google.com/presentation/d/11qMRvkBITydUE49zOFvrGTbBaOmOlA_tXeYMlI3tu9g/edit?usp=sharing">here</a>.</p>

<h1 id="introduction">Introduction</h1>

<p>Users want to provide here background information about the design of their ChIP-Seq project.</p>

<h2 id="background-and-objectives">Background and objectives</h2>

<p>This report describes the analysis of several ChIP-Seq experiments
studying the DNA binding patterns of the transcriptions factors … from
<em>organism</em> ….</p>

<h2 id="experimental-design">Experimental design</h2>

<p>Typically, users want to specify here all information relevant for the
analysis of their NGS study. This includes detailed descriptions of
FASTQ files, experimental design, reference genome, gene annotations,
etc.</p>

<h1 id="load-workflow-environment">Load workflow environment</h1>

<p>Now open the R markdown script <code class="highlighter-rouge">systemPipeChIPseq.Rmd</code>in your R IDE (<em>e.g.</em> vim-r or RStudio) and 
run the workflow as outlined below.</p>

<h2 id="load-packages-and-sample-data">Load packages and sample data</h2>

<p>The <code class="highlighter-rouge">systemPipeR</code> package needs to be loaded to perform the analysis steps shown in
this report [@Girke2014-oy].</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">systemPipeR</span><span class="p">)</span>
</code></pre>
</div>

<p>Load workflow environment with sample data into your current working
directory. The sample data are described
<a href="http://www.bioconductor.org/packages/devel/bioc/vignettes/systemPipeR/inst/doc/systemPipeR.html#load-sample-data-and-workflow-templates">here</a>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">systemPipeRdata</span><span class="p">)</span>
<span class="n">genWorkenvir</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="s2">"chipseq"</span><span class="p">)</span>
<span class="n">setwd</span><span class="p">(</span><span class="s2">"chipseq"</span><span class="p">)</span>
<span class="n">download.file</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/tgirke/GEN242/master/vignettes/12_ChIPseqWorkflow/systemPipeChIPseq.Rmd"</span><span class="p">,</span> <span class="s2">"systemPipeChIPseq.Rmd"</span><span class="p">)</span>
</code></pre>
</div>

<p>In the workflow environments generated by <code class="highlighter-rouge">genWorkenvir</code> all data inputs are stored in
a <code class="highlighter-rouge">data/</code> directory and all analysis results will be written to a separate
<code class="highlighter-rouge">results/</code> directory, while the <code class="highlighter-rouge">systemPipeChIPseq.Rmd</code> script and the <code class="highlighter-rouge">targets</code> file are expected to be located in
the parent directory. The R session is expected to run from this parent
directory. Additional parameter files are stored under <code class="highlighter-rouge">param/</code>.</p>

<p>To work with real data, users want to organize their own data similarly
and substitute all test data for their own data. To rerun an established
workflow on new data, the initial <code class="highlighter-rouge">targets</code> file along with the corresponding
FASTQ files are usually the only inputs the user needs to provide.</p>

<p>If applicable users can load custom functions not provided by <code class="highlighter-rouge">systemPipeR</code>. Skip
this step if this is not the case.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">source</span><span class="p">(</span><span class="s2">"systemPipeChIPseq_Fct.R"</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="experiment-definition-provided-by-targets-file">Experiment definition provided by <code class="highlighter-rouge">targets</code> file</h2>

<p>The <code class="highlighter-rouge">targets</code> file defines all FASTQ files and sample comparisons of the analysis workflow.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">targetspath</span> <span class="o">&lt;-</span> <span class="n">system.file</span><span class="p">(</span><span class="s2">"extdata"</span><span class="p">,</span> <span class="s2">"targets_chip.txt"</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="s2">"systemPipeR"</span><span class="p">)</span>
<span class="n">targets</span> <span class="o">&lt;-</span> <span class="n">read.delim</span><span class="p">(</span><span class="n">targetspath</span><span class="p">,</span> <span class="n">comment.char</span> <span class="o">=</span> <span class="s2">"#"</span><span class="p">)</span>
<span class="n">targets</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span><span class="o">-</span><span class="n">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">)]</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##                   FileName SampleName Factor SampleLong SampleReference
## 1 ./data/SRR446027_1.fastq        M1A     M1  Mock.1h.A                
## 2 ./data/SRR446028_1.fastq        M1B     M1  Mock.1h.B                
## 3 ./data/SRR446029_1.fastq        A1A     A1   Avr.1h.A             M1A
## 4 ./data/SRR446030_1.fastq        A1B     A1   Avr.1h.B             M1B
</code></pre>
</div>

<h1 id="read-preprocessing">Read preprocessing</h1>

<h2 id="read-quality-filtering-and-trimming">Read quality filtering and trimming</h2>

<p>The following example shows how one can design a custom read
preprocessing function using utilities provided by the <code class="highlighter-rouge">ShortRead</code> package, and then
apply it with <code class="highlighter-rouge">preprocessReads</code> in batch mode to all FASTQ samples referenced in the
corresponding <code class="highlighter-rouge">SYSargs</code> instance (<code class="highlighter-rouge">args</code> object below). More detailed information on
read preprocessing is provided in <code class="highlighter-rouge">systemPipeR's</code> main vignette.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">args</span> <span class="o">&lt;-</span> <span class="n">systemArgs</span><span class="p">(</span><span class="n">sysma</span><span class="o">=</span><span class="s2">"param/trim.param"</span><span class="p">,</span> <span class="n">mytargets</span><span class="o">=</span><span class="s2">"targets_chip.txt"</span><span class="p">)</span>
<span class="n">filterFct</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">fq</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="m">20</span><span class="p">,</span> <span class="n">Nexceptions</span><span class="o">=</span><span class="m">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">qcount</span> <span class="o">&lt;-</span> <span class="n">rowSums</span><span class="p">(</span><span class="n">as</span><span class="p">(</span><span class="n">quality</span><span class="p">(</span><span class="n">fq</span><span class="p">),</span> <span class="s2">"matrix"</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">cutoff</span><span class="p">)</span>
    <span class="n">fq</span><span class="p">[</span><span class="n">qcount</span> <span class="o">&lt;=</span> <span class="n">Nexceptions</span><span class="p">]</span> <span class="c1"># Retains reads where Phred scores are &gt;= cutoff with N exceptions
</span><span class="p">}</span>
<span class="n">preprocessReads</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">Fct</span><span class="o">=</span><span class="s2">"filterFct(fq, cutoff=20, Nexceptions=0)"</span><span class="p">,</span> <span class="n">batchsize</span><span class="o">=</span><span class="m">100000</span><span class="p">)</span>
<span class="n">writeTargetsout</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s2">"targets_chip_trim.txt"</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="fastq-quality-report">FASTQ quality report</h2>

<p>The following <code class="highlighter-rouge">seeFastq</code> and <code class="highlighter-rouge">seeFastqPlot</code> functions generate and plot a series of useful quality
statistics for a set of FASTQ files including per cycle quality box
plots, base proportions, base-level quality trends, relative k-mer
diversity, length and occurrence distribution of reads, number of reads
above quality cutoffs and mean quality distribution. The results are
written to a PDF file named <code class="highlighter-rouge">fastqReport.pdf</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">args</span> <span class="o">&lt;-</span> <span class="n">systemArgs</span><span class="p">(</span><span class="n">sysma</span><span class="o">=</span><span class="s2">"param/tophat.param"</span><span class="p">,</span> <span class="n">mytargets</span><span class="o">=</span><span class="s2">"targets_chip.txt"</span><span class="p">)</span>
<span class="n">fqlist</span> <span class="o">&lt;-</span> <span class="n">seeFastq</span><span class="p">(</span><span class="n">fastq</span><span class="o">=</span><span class="n">infile1</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="n">batchsize</span><span class="o">=</span><span class="m">100000</span><span class="p">,</span> <span class="n">klength</span><span class="o">=</span><span class="m">8</span><span class="p">)</span>
<span class="n">pdf</span><span class="p">(</span><span class="s2">"./results/fastqReport.pdf"</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="m">18</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">4</span><span class="o">*</span><span class="n">length</span><span class="p">(</span><span class="n">fqlist</span><span class="p">))</span>
<span class="n">seeFastqPlot</span><span class="p">(</span><span class="n">fqlist</span><span class="p">)</span>
<span class="n">dev.off</span><span class="p">()</span>
</code></pre>
</div>

<p><img src="fastqReport.png" alt="" /></p>
<div align="center">Figure 1: FASTQ quality report for 18 samples</div>
<p>&lt;/br&gt;</p>

<h1 id="alignments">Alignments</h1>

<h2 id="read-mapping-with-bowtie2">Read mapping with <code class="highlighter-rouge">Bowtie2</code></h2>

<p>The NGS reads of this project will be aligned with <code class="highlighter-rouge">Bowtie2</code> against the
reference genome sequence [@Langmead2012-bs]. The parameter settings of the
aligner are defined in the <code class="highlighter-rouge">bowtieSE.param</code> file. In ChIP-Seq experiments it is
usually more appropriate to eliminate reads mapping to multiple locations. To
achieve this, users want to remove the argument setting <code class="highlighter-rouge">-k 50 –non-deterministic</code> 
in the <code class="highlighter-rouge">bowtieSE.param</code> file.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">args</span> <span class="o">&lt;-</span> <span class="n">systemArgs</span><span class="p">(</span><span class="n">sysma</span><span class="o">=</span><span class="s2">"param/bowtieSE.param"</span><span class="p">,</span> <span class="n">mytargets</span><span class="o">=</span><span class="s2">"targets_chip_trim.txt"</span><span class="p">)</span>
<span class="n">sysargs</span><span class="p">(</span><span class="n">args</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span> <span class="c1"># Command-line parameters for first FASTQ file
</span><span class="n">moduleload</span><span class="p">(</span><span class="n">modules</span><span class="p">(</span><span class="n">args</span><span class="p">))</span> <span class="c1"># Skip if a module system is not used
</span><span class="n">system</span><span class="p">(</span><span class="s2">"bowtie2-build ./data/tair10.fasta ./data/tair10.fasta"</span><span class="p">)</span> <span class="c1"># Indexes reference genome
</span><span class="n">runCommandline</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="n">writeTargetsout</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s2">"targets_bam.txt"</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
</code></pre>
</div>

<p>Check whether all BAM files have been created</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">file.exists</span><span class="p">(</span><span class="n">outpaths</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
</code></pre>
</div>

<h2 id="read-and-alignment-stats">Read and alignment stats</h2>

<p>The following provides an overview of the number of reads in each sample
and how many of them aligned to the reference.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">read_statsDF</span> <span class="o">&lt;-</span> <span class="n">alignStats</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span> 
<span class="n">write.table</span><span class="p">(</span><span class="n">read_statsDF</span><span class="p">,</span> <span class="s2">"results/alignStats.xls"</span><span class="p">,</span> <span class="n">row.names</span><span class="o">=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">)</span>
<span class="n">read.delim</span><span class="p">(</span><span class="s2">"results/alignStats.xls"</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="create-symbolic-links-for-viewing-bam-files-in-igv">Create symbolic links for viewing BAM files in IGV</h2>

<p>The <code class="highlighter-rouge">symLink2bam</code> function creates symbolic links to view the BAM alignment files in a
genome browser such as IGV without moving these large files to a local
system. The corresponding URLs are written to a file with a path
specified under <code class="highlighter-rouge">urlfile</code>, here <code class="highlighter-rouge">IGVurl.txt</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">symLink2bam</span><span class="p">(</span><span class="n">sysargs</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">htmldir</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"~/.html/"</span><span class="p">,</span> <span class="s2">"somedir/"</span><span class="p">),</span> 
            <span class="n">urlbase</span><span class="o">=</span><span class="s2">"http://biocluster.ucr.edu/~tgirke/"</span><span class="p">,</span> 
            <span class="n">urlfile</span><span class="o">=</span><span class="s2">"./results/IGVurl.txt"</span><span class="p">)</span>
</code></pre>
</div>

<h1 id="utilities-for-coverage-data">Utilities for coverage data</h1>

<p>The following introduces several utilities useful for ChIP-Seq data. They are not part of the actual
workflow.</p>

<h2 id="rle-object-stores-coverage-information">Rle object stores coverage information</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">rtracklayer</span><span class="p">);</span> <span class="n">library</span><span class="p">(</span><span class="n">GenomicRanges</span><span class="p">);</span> <span class="n">library</span><span class="p">(</span><span class="n">Rsamtools</span><span class="p">);</span> <span class="n">library</span><span class="p">(</span><span class="n">GenomicAlignments</span><span class="p">)</span>
<span class="n">aligns</span> <span class="o">&lt;-</span> <span class="n">readGAlignments</span><span class="p">(</span><span class="n">outpaths</span><span class="p">(</span><span class="n">args</span><span class="p">)[</span><span class="m">1</span><span class="p">])</span>
<span class="n">cov</span> <span class="o">&lt;-</span> <span class="n">coverage</span><span class="p">(</span><span class="n">aligns</span><span class="p">)</span>
<span class="n">cov</span>
</code></pre>
</div>

<h2 id="resizing-aligned-reads">Resizing aligned reads</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">trim</span><span class="p">(</span><span class="n">resize</span><span class="p">(</span><span class="n">as</span><span class="p">(</span><span class="n">aligns</span><span class="p">,</span> <span class="s2">"GRanges"</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="m">200</span><span class="p">))</span>
</code></pre>
</div>

<h2 id="naive-peak-calling">Naive peak calling</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">islands</span> <span class="o">&lt;-</span> <span class="n">slice</span><span class="p">(</span><span class="n">cov</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="m">15</span><span class="p">)</span>
<span class="n">islands</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
</code></pre>
</div>

<h2 id="plot-coverage-for-defined-region">Plot coverage for defined region</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggbio</span><span class="p">)</span>
<span class="n">myloc</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s2">"Chr1"</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">100000</span><span class="p">)</span>
<span class="n">ga</span> <span class="o">&lt;-</span> <span class="n">readGAlignments</span><span class="p">(</span><span class="n">outpaths</span><span class="p">(</span><span class="n">args</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span> <span class="n">use.names</span><span class="o">=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">ScanBamParam</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="n">GRanges</span><span class="p">(</span><span class="n">myloc</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">IRanges</span><span class="p">(</span><span class="n">as.numeric</span><span class="p">(</span><span class="n">myloc</span><span class="p">[</span><span class="m">2</span><span class="p">]),</span> <span class="n">as.numeric</span><span class="p">(</span><span class="n">myloc</span><span class="p">[</span><span class="m">3</span><span class="p">])))))</span>
<span class="n">autoplot</span><span class="p">(</span><span class="n">ga</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">strand</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">strand</span><span class="p">),</span> <span class="n">facets</span> <span class="o">=</span> <span class="n">strand</span> <span class="o">~</span> <span class="n">seqnames</span><span class="p">,</span> <span class="n">stat</span> <span class="o">=</span> <span class="s2">"coverage"</span><span class="p">)</span>
</code></pre>
</div>

<h1 id="peak-calling-with-macs2">Peak calling with MACS2</h1>

<h2 id="merge-bam-files-of-replicates-prior-to-peak-calling">Merge BAM files of replicates prior to peak calling</h2>

<p>Merging BAM files of technical and/or biological replicates can improve
the sensitivity of the peak calling by increasing the depth of read
coverage. The <code class="highlighter-rouge">mergeBamByFactor</code> function merges BAM files based on grouping information
specified by a <code class="highlighter-rouge">factor</code>, here the <code class="highlighter-rouge">Factor</code> column of the imported targets file. It 
also returns an updated <code class="highlighter-rouge">SYSargs</code> object containing the paths to the
merged BAM files as well as to any unmerged files without replicates.
This step can be skipped if merging of BAM files is not desired.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">args</span> <span class="o">&lt;-</span> <span class="n">systemArgs</span><span class="p">(</span><span class="n">sysma</span><span class="o">=</span><span class="n">NULL</span><span class="p">,</span> <span class="n">mytargets</span><span class="o">=</span><span class="s2">"targets_bam.txt"</span><span class="p">)</span>
<span class="n">args_merge</span> <span class="o">&lt;-</span> <span class="n">mergeBamByFactor</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">writeTargetsout</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">args_merge</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s2">"targets_mergeBamByFactor.txt"</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="peak-calling-without-inputreference-sample">Peak calling without input/reference sample</h2>

<p>MACS2 can perform peak calling on ChIP-Seq data with and without input
samples [@Zhang2008-pc]. The following performs peak calling without
input on all samples specified in the corresponding <code class="highlighter-rouge">args</code> object. Note, due to
the small size of the sample data, MACS2 needs to be run here with the
<code class="highlighter-rouge">–nomodel</code> setting. For real data sets, users want to remove this parameter 
in the corresponding <code class="highlighter-rouge">*.param</code> file(s).</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">args</span> <span class="o">&lt;-</span> <span class="n">systemArgs</span><span class="p">(</span><span class="n">sysma</span><span class="o">=</span><span class="s2">"param/macs2_noinput.param"</span><span class="p">,</span> <span class="n">mytargets</span><span class="o">=</span><span class="s2">"targets_mergeBamByFactor.txt"</span><span class="p">)</span>
<span class="n">sysargs</span><span class="p">(</span><span class="n">args</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span> <span class="c1"># Command-line parameters for first FASTQ file
</span><span class="n">runCommandline</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="n">file.exists</span><span class="p">(</span><span class="n">outpaths</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
<span class="n">writeTargetsout</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s2">"targets_macs.txt"</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="peak-calling-with-inputreference-sample">Peak calling with input/reference sample</h2>

<p>To perform peak calling with input samples, they can be most
conveniently specified in the <code class="highlighter-rouge">SampleReference</code> column of the initial
<code class="highlighter-rouge">targets</code> file. The <code class="highlighter-rouge">writeTargetsRef</code> function uses this information to create a <code class="highlighter-rouge">targets</code> 
file intermediate for running MACS2 with the corresponding input samples.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">writeTargetsRef</span><span class="p">(</span><span class="n">infile</span><span class="o">=</span><span class="s2">"targets_mergeBamByFactor.txt"</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="s2">"targets_bam_ref.txt"</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">args</span> <span class="o">&lt;-</span> <span class="n">systemArgs</span><span class="p">(</span><span class="n">sysma</span><span class="o">=</span><span class="s2">"param/macs2.param"</span><span class="p">,</span> <span class="n">mytargets</span><span class="o">=</span><span class="s2">"targets_bam_ref.txt"</span><span class="p">)</span>
<span class="n">sysargs</span><span class="p">(</span><span class="n">args</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span> <span class="c1"># Command-line parameters for first FASTQ file
</span><span class="n">runCommandline</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="n">file.exists</span><span class="p">(</span><span class="n">outpaths</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
<span class="n">writeTargetsout</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s2">"targets_macs.txt"</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
</code></pre>
</div>

<p>The peak calling results from MACS2 are written for each sample to
separate files in the <code class="highlighter-rouge">results</code> directory. They are named after the corresponding
files with extensions used by MACS2.</p>

<h2 id="identify-consensus-peaks">Identify consensus peaks</h2>

<p>The following example shows how one can identify consensus preaks among two peak sets sharing either a minimum absolute overlap and/or
minimum relative overlap using the <code class="highlighter-rouge">subsetByOverlaps</code> or <code class="highlighter-rouge">olRanges</code> functions, respectively. Note, the latter is
a custom function imported below by sourcing it.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">source</span><span class="p">(</span><span class="s2">"http://faculty.ucr.edu/~tgirke/Documents/R_BioCond/My_R_Scripts/rangeoverlapper.R"</span><span class="p">)</span>
<span class="n">peak_M1A</span> <span class="o">&lt;-</span> <span class="n">outpaths</span><span class="p">(</span><span class="n">args</span><span class="p">)[</span><span class="s2">"M1A"</span><span class="p">]</span>
<span class="n">peak_M1A</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">(</span><span class="n">read.delim</span><span class="p">(</span><span class="n">peak_M1A</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">"#"</span><span class="p">)[,</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">],</span> <span class="s2">"GRanges"</span><span class="p">)</span>
<span class="n">peak_A1A</span> <span class="o">&lt;-</span> <span class="n">outpaths</span><span class="p">(</span><span class="n">args</span><span class="p">)[</span><span class="s2">"A1A"</span><span class="p">]</span>
<span class="n">peak_A1A</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">(</span><span class="n">read.delim</span><span class="p">(</span><span class="n">peak_A1A</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">"#"</span><span class="p">)[,</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">],</span> <span class="s2">"GRanges"</span><span class="p">)</span>
<span class="p">(</span><span class="n">myol1</span> <span class="o">&lt;-</span> <span class="n">subsetByOverlaps</span><span class="p">(</span><span class="n">peak_M1A</span><span class="p">,</span> <span class="n">peak_A1A</span><span class="p">,</span> <span class="n">minoverlap</span><span class="o">=</span><span class="m">1</span><span class="p">))</span> <span class="c1"># Returns any overlap
</span><span class="n">myol2</span> <span class="o">&lt;-</span> <span class="n">olRanges</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">peak_M1A</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="n">peak_A1A</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s2">"gr"</span><span class="p">)</span> <span class="c1"># Returns any overlap with OL length information
</span><span class="n">myol2</span><span class="p">[</span><span class="n">values</span><span class="p">(</span><span class="n">myol2</span><span class="p">)[</span><span class="s2">"OLpercQ"</span><span class="p">][,</span><span class="m">1</span><span class="p">]</span><span class="o">&gt;=</span><span class="m">50</span><span class="p">]</span> <span class="c1"># Returns only query peaks with a minimum overlap of 50%
</span></code></pre>
</div>

<h1 id="annotate-peaks-with-genomic-context">Annotate peaks with genomic context</h1>

<h2 id="annotation-with-chippeakanno-package">Annotation with <code class="highlighter-rouge">ChIPpeakAnno</code> package</h2>

<p>The following annotates the identified peaks with genomic context
information using the <code class="highlighter-rouge">ChIPpeakAnno</code> and <code class="highlighter-rouge">ChIPseeker</code> packages, respectively
[@Zhu2010-zo; @Yu2015-xu].</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ChIPpeakAnno</span><span class="p">);</span> <span class="n">library</span><span class="p">(</span><span class="n">GenomicFeatures</span><span class="p">)</span>
<span class="n">args</span> <span class="o">&lt;-</span> <span class="n">systemArgs</span><span class="p">(</span><span class="n">sysma</span><span class="o">=</span><span class="s2">"param/annotate_peaks.param"</span><span class="p">,</span> <span class="n">mytargets</span><span class="o">=</span><span class="s2">"targets_macs.txt"</span><span class="p">)</span>
<span class="c1"># txdb &lt;- loadDb("./data/tair10.sqlite")
</span><span class="n">txdb</span> <span class="o">&lt;-</span> <span class="n">makeTxDbFromGFF</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">"data/tair10.gff"</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">"gff"</span><span class="p">,</span> <span class="n">dataSource</span><span class="o">=</span><span class="s2">"TAIR"</span><span class="p">,</span> <span class="n">organism</span><span class="o">=</span><span class="s2">"Arabidopsis thaliana"</span><span class="p">)</span>
<span class="n">ge</span> <span class="o">&lt;-</span> <span class="n">genes</span><span class="p">(</span><span class="n">txdb</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"tx_name"</span><span class="p">,</span> <span class="s2">"gene_id"</span><span class="p">,</span> <span class="s2">"tx_type"</span><span class="p">))</span> 
<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">seq</span><span class="p">(</span><span class="n">along</span><span class="o">=</span><span class="n">args</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">peaksGR</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">(</span><span class="n">read.delim</span><span class="p">(</span><span class="n">infile1</span><span class="p">(</span><span class="n">args</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">comment</span><span class="o">=</span><span class="s2">"#"</span><span class="p">),</span> <span class="s2">"GRanges"</span><span class="p">)</span>
    <span class="n">annotatedPeak</span> <span class="o">&lt;-</span> <span class="n">annotatePeakInBatch</span><span class="p">(</span><span class="n">peaksGR</span><span class="p">,</span> <span class="n">AnnotationData</span><span class="o">=</span><span class="n">genes</span><span class="p">(</span><span class="n">txdb</span><span class="p">))</span>
    <span class="n">df</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">annotatedPeak</span><span class="p">),</span> <span class="n">as.data.frame</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">ge</span><span class="p">[</span><span class="n">values</span><span class="p">(</span><span class="n">annotatedPeak</span><span class="p">)</span><span class="o">$</span><span class="n">feature</span><span class="p">,])))</span>
    <span class="n">write.table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">outpaths</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">quote</span><span class="o">=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">row.names</span><span class="o">=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">writeTargetsout</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s2">"targets_peakanno.txt"</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
</code></pre>
</div>

<p>The peak annotation results are written for each peak set to separate
files in the <code class="highlighter-rouge">results</code> directory. They are named after the corresponding peak
files with extensions specified in the <code class="highlighter-rouge">annotate_peaks.param</code> file, 
here <code class="highlighter-rouge">*.peaks.annotated.xls</code>.</p>

<h2 id="annotation-with-chipseeker-package">Annotation with <code class="highlighter-rouge">ChIPseeker</code> package</h2>

<p>Same as in previous step but using the <code class="highlighter-rouge">ChIPseeker</code> package for annotating the peaks.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ChIPseeker</span><span class="p">)</span>
<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">seq</span><span class="p">(</span><span class="n">along</span><span class="o">=</span><span class="n">args</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">peakAnno</span> <span class="o">&lt;-</span> <span class="n">annotatePeak</span><span class="p">(</span><span class="n">infile1</span><span class="p">(</span><span class="n">args</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">TxDb</span><span class="o">=</span><span class="n">txdb</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">&lt;-</span> <span class="n">as.data.frame</span><span class="p">(</span><span class="n">peakAnno</span><span class="p">)</span>
    <span class="n">write.table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">outpaths</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">quote</span><span class="o">=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">row.names</span><span class="o">=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">writeTargetsout</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s2">"targets_peakanno.txt"</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
</code></pre>
</div>

<p>Summary plots provided by the <code class="highlighter-rouge">ChIPseeker</code> package. Here applied only to one sample
for demonstration purposes.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">peak</span> <span class="o">&lt;-</span> <span class="n">readPeakFile</span><span class="p">(</span><span class="n">infile1</span><span class="p">(</span><span class="n">args</span><span class="p">)[</span><span class="m">1</span><span class="p">])</span>
<span class="n">covplot</span><span class="p">(</span><span class="n">peak</span><span class="p">,</span> <span class="n">weightCol</span><span class="o">=</span><span class="s2">"X.log10.pvalue."</span><span class="p">)</span>
<span class="n">peakHeatmap</span><span class="p">(</span><span class="n">outpaths</span><span class="p">(</span><span class="n">args</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span> <span class="n">TxDb</span><span class="o">=</span><span class="n">txdb</span><span class="p">,</span> <span class="n">upstream</span><span class="o">=</span><span class="m">1000</span><span class="p">,</span> <span class="n">downstream</span><span class="o">=</span><span class="m">1000</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span>
<span class="n">plotAvgProf2</span><span class="p">(</span><span class="n">outpaths</span><span class="p">(</span><span class="n">args</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span> <span class="n">TxDb</span><span class="o">=</span><span class="n">txdb</span><span class="p">,</span> <span class="n">upstream</span><span class="o">=</span><span class="m">1000</span><span class="p">,</span> <span class="n">downstream</span><span class="o">=</span><span class="m">1000</span><span class="p">,</span> <span class="n">xlab</span><span class="o">=</span><span class="s2">"Genomic Region (5'-&gt;3')"</span><span class="p">,</span> <span class="n">ylab</span> <span class="o">=</span> <span class="s2">"Read Count Frequency"</span><span class="p">)</span>
</code></pre>
</div>

<h1 id="count-reads-overlapping-peaks">Count reads overlapping peaks</h1>

<p>The <code class="highlighter-rouge">countRangeset</code> function is a convenience wrapper to perform read counting
iteratively over serveral range sets, here peak range sets. Internally,
the read counting is performed with the <code class="highlighter-rouge">summarizeOverlaps</code> function from the 
<code class="highlighter-rouge">GenomicAlignments</code> package. The resulting count tables are directly saved to 
files, one for each peak set.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">GenomicRanges</span><span class="p">)</span>
<span class="n">args</span> <span class="o">&lt;-</span> <span class="n">systemArgs</span><span class="p">(</span><span class="n">sysma</span><span class="o">=</span><span class="s2">"param/count_rangesets.param"</span><span class="p">,</span> <span class="n">mytargets</span><span class="o">=</span><span class="s2">"targets_macs.txt"</span><span class="p">)</span>
<span class="n">args_bam</span> <span class="o">&lt;-</span> <span class="n">systemArgs</span><span class="p">(</span><span class="n">sysma</span><span class="o">=</span><span class="n">NULL</span><span class="p">,</span> <span class="n">mytargets</span><span class="o">=</span><span class="s2">"targets_bam.txt"</span><span class="p">)</span>
<span class="n">bfl</span> <span class="o">&lt;-</span> <span class="n">BamFileList</span><span class="p">(</span><span class="n">outpaths</span><span class="p">(</span><span class="n">args_bam</span><span class="p">),</span> <span class="n">yieldSize</span><span class="o">=</span><span class="m">50000</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">character</span><span class="p">())</span>
<span class="n">countDFnames</span> <span class="o">&lt;-</span> <span class="n">countRangeset</span><span class="p">(</span><span class="n">bfl</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"Union"</span><span class="p">,</span> <span class="n">ignore.strand</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">writeTargetsout</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s2">"targets_countDF.txt"</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
</code></pre>
</div>

<h1 id="differential-binding-analysis">Differential binding analysis</h1>

<p>The <code class="highlighter-rouge">runDiff</code> function performs differential binding analysis in batch mode for
several count tables using <code class="highlighter-rouge">edgeR</code> or <code class="highlighter-rouge">DESeq2</code> [@Robinson2010-uk; @Love2014-sh].
Internally, it calls the functions <code class="highlighter-rouge">run_edgeR</code> and <code class="highlighter-rouge">run_DESeq2</code>. It also returns 
the filtering results and plots from the downstream <code class="highlighter-rouge">filterDEGs</code> function using 
the fold change and FDR cutoffs provided under the <code class="highlighter-rouge">dbrfilter</code> argument.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">args_diff</span> <span class="o">&lt;-</span> <span class="n">systemArgs</span><span class="p">(</span><span class="n">sysma</span><span class="o">=</span><span class="s2">"param/rundiff.param"</span><span class="p">,</span> <span class="n">mytargets</span><span class="o">=</span><span class="s2">"targets_countDF.txt"</span><span class="p">)</span>
<span class="n">cmp</span> <span class="o">&lt;-</span> <span class="n">readComp</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">args_bam</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">"matrix"</span><span class="p">)</span> 
<span class="n">dbrlist</span> <span class="o">&lt;-</span> <span class="n">runDiff</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args_diff</span><span class="p">,</span> <span class="n">diffFct</span><span class="o">=</span><span class="n">run_edgeR</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="n">targetsin</span><span class="p">(</span><span class="n">args_bam</span><span class="p">),</span> 
                    <span class="n">cmp</span><span class="o">=</span><span class="n">cmp</span><span class="p">[[</span><span class="m">1</span><span class="p">]],</span> <span class="n">independent</span><span class="o">=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">dbrfilter</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">Fold</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">FDR</span><span class="o">=</span><span class="m">1</span><span class="p">))</span>
<span class="n">writeTargetsout</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">args_diff</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s2">"targets_rundiff.txt"</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
</code></pre>
</div>

<h1 id="go-term-enrichment-analysis">GO term enrichment analysis</h1>

<p>The following performs GO term enrichment analysis for each annotated peak set.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">args</span> <span class="o">&lt;-</span> <span class="n">systemArgs</span><span class="p">(</span><span class="n">sysma</span><span class="o">=</span><span class="s2">"param/macs2.param"</span><span class="p">,</span> <span class="n">mytargets</span><span class="o">=</span><span class="s2">"targets_bam_ref.txt"</span><span class="p">)</span>
<span class="n">args_anno</span> <span class="o">&lt;-</span> <span class="n">systemArgs</span><span class="p">(</span><span class="n">sysma</span><span class="o">=</span><span class="s2">"param/annotate_peaks.param"</span><span class="p">,</span> <span class="n">mytargets</span><span class="o">=</span><span class="s2">"targets_macs.txt"</span><span class="p">)</span>
<span class="n">annofiles</span> <span class="o">&lt;-</span> <span class="n">outpaths</span><span class="p">(</span><span class="n">args_anno</span><span class="p">)</span>
<span class="n">gene_ids</span> <span class="o">&lt;-</span> <span class="n">sapply</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">annofiles</span><span class="p">),</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">unique</span><span class="p">(</span><span class="n">as.character</span><span class="p">(</span><span class="n">read.delim</span><span class="p">(</span><span class="n">annofiles</span><span class="p">[</span><span class="n">x</span><span class="p">])[,</span><span class="s2">"gene_id"</span><span class="p">])))</span>
<span class="n">load</span><span class="p">(</span><span class="s2">"data/GO/catdb.RData"</span><span class="p">)</span>
<span class="n">BatchResult</span> <span class="o">&lt;-</span> <span class="n">GOCluster_Report</span><span class="p">(</span><span class="n">catdb</span><span class="o">=</span><span class="n">catdb</span><span class="p">,</span> <span class="n">setlist</span><span class="o">=</span><span class="n">gene_ids</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">"all"</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">"gene"</span><span class="p">,</span> <span class="n">CLSZ</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="m">0.9</span><span class="p">,</span> <span class="n">gocats</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"MF"</span><span class="p">,</span> <span class="s2">"BP"</span><span class="p">,</span> <span class="s2">"CC"</span><span class="p">),</span> <span class="n">recordSpecGO</span><span class="o">=</span><span class="n">NULL</span><span class="p">)</span>
</code></pre>
</div>

<h1 id="motif-analysis">Motif analysis</h1>

<h2 id="parse-dna-sequences-of-peak-regions-from-genome">Parse DNA sequences of peak regions from genome</h2>

<p>Enrichment analysis of known DNA binding motifs or <em>de novo</em> discovery
of novel motifs requires the DNA sequences of the identified peak
regions. To parse the corresponding sequences from the reference genome,
the <code class="highlighter-rouge">getSeq</code> function from the <code class="highlighter-rouge">Biostrings</code> package can be used. The 
following example parses the sequences for each peak set and saves the 
results to separate FASTA files, one for each peak set. In addition, the 
sequences in the FASTA files are ranked (sorted) by increasing p-values 
as expected by some motif discovery tools, such as <code class="highlighter-rouge">BCRANK</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">Biostrings</span><span class="p">);</span> <span class="n">library</span><span class="p">(</span><span class="n">seqLogo</span><span class="p">);</span> <span class="n">library</span><span class="p">(</span><span class="n">BCRANK</span><span class="p">)</span>
<span class="n">args</span> <span class="o">&lt;-</span> <span class="n">systemArgs</span><span class="p">(</span><span class="n">sysma</span><span class="o">=</span><span class="s2">"param/annotate_peaks.param"</span><span class="p">,</span> <span class="n">mytargets</span><span class="o">=</span><span class="s2">"targets_macs.txt"</span><span class="p">)</span>
<span class="n">rangefiles</span> <span class="o">&lt;-</span> <span class="n">infile1</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">seq</span><span class="p">(</span><span class="n">along</span><span class="o">=</span><span class="n">rangefiles</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">df</span> <span class="o">&lt;-</span> <span class="n">read.delim</span><span class="p">(</span><span class="n">rangefiles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">comment</span><span class="o">=</span><span class="s2">"#"</span><span class="p">)</span>
    <span class="n">peaks</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">"GRanges"</span><span class="p">)</span>
    <span class="n">names</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">paste0</span><span class="p">(</span><span class="n">as.character</span><span class="p">(</span><span class="n">seqnames</span><span class="p">(</span><span class="n">peaks</span><span class="p">)),</span> <span class="s2">"_"</span><span class="p">,</span> <span class="n">start</span><span class="p">(</span><span class="n">peaks</span><span class="p">),</span> <span class="s2">"-"</span><span class="p">,</span> <span class="n">end</span><span class="p">(</span><span class="n">peaks</span><span class="p">))</span>
    <span class="n">peaks</span> <span class="o">&lt;-</span> <span class="n">peaks</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span><span class="o">$</span><span class="n">X.log10.pvalue</span><span class="p">,</span> <span class="n">decreasing</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)]</span>
    <span class="n">pseq</span> <span class="o">&lt;-</span> <span class="n">getSeq</span><span class="p">(</span><span class="n">FaFile</span><span class="p">(</span><span class="s2">"./data/tair10.fasta"</span><span class="p">),</span> <span class="n">peaks</span><span class="p">)</span>
    <span class="n">names</span><span class="p">(</span><span class="n">pseq</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">names</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span>
    <span class="n">writeXStringSet</span><span class="p">(</span><span class="n">pseq</span><span class="p">,</span> <span class="n">paste0</span><span class="p">(</span><span class="n">rangefiles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">".fasta"</span><span class="p">))</span> 
<span class="p">}</span>
</code></pre>
</div>

<h2 id="motif-discovery-with-bcrank">Motif discovery with <code class="highlighter-rouge">BCRANK</code></h2>

<p>The Bioconductor package <code class="highlighter-rouge">BCRANK</code> is one of the many tools available for 
<em>de novo</em> discovery of DNA binding motifs in peak regions of ChIP-Seq
experiments. The given example applies this method on the first peak
sample set and plots the sequence logo of the highest ranking motif.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="n">BCRANKout</span> <span class="o">&lt;-</span> <span class="n">bcrank</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">rangefiles</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="s2">".fasta"</span><span class="p">),</span> <span class="n">restarts</span><span class="o">=</span><span class="m">25</span><span class="p">,</span> <span class="n">use.P1</span><span class="o">=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">use.P2</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">toptable</span><span class="p">(</span><span class="n">BCRANKout</span><span class="p">)</span>
<span class="n">topMotif</span> <span class="o">&lt;-</span> <span class="n">toptable</span><span class="p">(</span><span class="n">BCRANKout</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
<span class="n">weightMatrix</span> <span class="o">&lt;-</span> <span class="n">pwm</span><span class="p">(</span><span class="n">topMotif</span><span class="p">,</span> <span class="n">normalize</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
<span class="n">weightMatrixNormalized</span> <span class="o">&lt;-</span> <span class="n">pwm</span><span class="p">(</span><span class="n">topMotif</span><span class="p">,</span> <span class="n">normalize</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>
<span class="n">pdf</span><span class="p">(</span><span class="s2">"results/seqlogo.pdf"</span><span class="p">)</span>
<span class="n">seqLogo</span><span class="p">(</span><span class="n">weightMatrixNormalized</span><span class="p">)</span>
<span class="n">dev.off</span><span class="p">()</span>
</code></pre>
</div>

<p><img src="seqlogo.png" alt="" /></p>
<div align="center">Figure 2: One of the motifs identified by `BCRANK`</div>
<p>&lt;/br&gt;</p>

<h1 id="version-information">Version Information</h1>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">sessionInfo</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## R version 3.2.5 (2016-04-14)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 14.04.4 LTS
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_US.UTF-8       
##  [4] LC_COLLATE=en_US.UTF-8     LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  LC_ADDRESS=C              
## [10] LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats4    parallel  stats     graphics  utils     datasets  grDevices methods   base     
## 
## other attached packages:
##  [1] ape_3.4                    ggplot2_2.0.0              systemPipeR_1.4.8         
##  [4] RSQLite_1.0.0              DBI_0.3.1                  ShortRead_1.28.0          
##  [7] GenomicAlignments_1.6.1    SummarizedExperiment_1.0.1 Biobase_2.30.0            
## [10] BiocParallel_1.4.0         Rsamtools_1.22.0           Biostrings_2.38.2         
## [13] XVector_0.10.0             GenomicRanges_1.22.1       GenomeInfoDb_1.6.1        
## [16] IRanges_2.4.4              S4Vectors_0.8.3            BiocGenerics_0.16.1       
## [19] BiocStyle_1.8.0           
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.3            lattice_0.20-33        GO.db_3.2.2            digest_0.6.9          
##  [5] plyr_1.8.3             futile.options_1.0.0   BatchJobs_1.6          evaluate_0.8          
##  [9] zlibbioc_1.16.0        GenomicFeatures_1.22.6 annotate_1.48.0        Matrix_1.2-3          
## [13] checkmate_1.6.3        rmarkdown_0.9.2        GOstats_2.36.0         splines_3.2.5         
## [17] stringr_1.0.0          pheatmap_1.0.7         RCurl_1.95-4.7         biomaRt_2.26.1        
## [21] munsell_0.4.2          sendmailR_1.2-1        rtracklayer_1.30.1     base64enc_0.1-3       
## [25] BBmisc_1.9             htmltools_0.3          fail_1.3               edgeR_3.12.0          
## [29] codetools_0.2-14       XML_3.98-1.3           AnnotationForge_1.12.0 bitops_1.0-6          
## [33] grid_3.2.5             RBGL_1.46.0            nlme_3.1-122           xtable_1.8-0          
## [37] GSEABase_1.32.0        gtable_0.1.2           magrittr_1.5           formatR_1.2.1         
## [41] scales_0.3.0           graph_1.48.0           stringi_1.0-1          hwriter_1.3.2         
## [45] genefilter_1.52.0      limma_3.26.3           latticeExtra_0.6-26    futile.logger_1.4.1   
## [49] brew_1.0-6             rjson_0.2.15           lambda.r_1.1.7         RColorBrewer_1.1-2    
## [53] tools_3.2.5            Category_2.36.0        survival_2.38-3        yaml_2.1.13           
## [57] AnnotationDbi_1.32.0   colorspace_1.2-6       knitr_1.12
</code></pre>
</div>

<h1 id="funding">Funding</h1>

<p>This project was supported by funds from the National Institutes of
Health (NIH) and the National Science Foundation (NSF).</p>

<h1 id="references">References</h1>



<div class="tags">
    
</div>



</div>



<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2016 UC Riverside. All rights reserved. <br />
 Site last generated: Aug 11, 2016 <br />
<p><img src="../common_images/company_logo.png/></p>
                </div>
            </div>
</footer>

            </div><!-- /.row -->

    </div>    <!-- /.container -->

</body>


</html>

